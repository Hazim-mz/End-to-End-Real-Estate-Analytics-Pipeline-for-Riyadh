{"timestamp":"2025-07-21T18:09:22.627472","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-07-21T18:09:22.630269","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/load_historical_data.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-07-21T18:09:24.233970","level":"info","event":"Loading only the historical data file...","logger":"transformer"}
{"timestamp":"2025-07-21T18:09:26.164355","level":"info","event":"Loaded 99969 records from data/raw/realstate_data_2014_2016.csv (utf-8)","logger":"transformer"}
{"timestamp":"2025-07-21T18:09:26.169127","level":"info","event":"Total raw records loaded: 99969","logger":"transformer"}
{"timestamp":"2025-07-21T18:09:27.425878","level":"info","event":"Price per sqm - Min: 0.05272727272727273, Max: 100000.0, Mean: 4581.303909547972","logger":"transformer"}
{"timestamp":"2025-07-21T18:09:27.426649","level":"info","event":"Price per bedroom - Min: 11.0, Max: 1000000.0, Mean: 336141.05722317763","logger":"transformer"}
{"timestamp":"2025-07-21T18:09:27.784201","level":"info","event":"Warehouse data saved to data/warehouse/riyadh_yasmeen_malga.csv","logger":"transformer"}
{"timestamp":"2025-07-21T18:09:27.784494","level":"info","event":"Data quality report saved to data/warehouse/quality_report.json","logger":"transformer"}
{"timestamp":"2025-07-21T18:09:27.807658","level":"info","event":"Successfully connected to PostgreSQL database","logger":"loader"}
{"timestamp":"2025-07-21T18:09:27.811772","level":"info","event":"Tables already exist, skipping creation","logger":"loader"}
{"timestamp":"2025-07-21T18:09:27.821461","level":"info","event":"Loading 10021 properties to database using batch UPSERT","logger":"loader"}
{"timestamp":"2025-07-21T18:09:27.823994","level":"info","event":"Property IDs in data: 10021 unique IDs","logger":"loader"}
{"timestamp":"2025-07-21T18:09:27.826841","level":"info","event":"Found 226 existing property_ids in database","logger":"loader"}
{"timestamp":"2025-07-21T18:09:27.830777","level":"info","event":"All property_ids are new - will be inserted","logger":"loader"}
{"timestamp":"2025-07-21T18:09:31.503748","level":"info","event":"Executing batch UPSERT with 10021 records","logger":"loader"}
{"timestamp":"2025-07-21T18:09:31.504184","level":"info","event":"UPSERT Query: \n            INSERT INTO properties (property_id, price, bedrooms, area, bathrooms, property_type, property_type_standard, price_per_sqm, price_per_bedroom, city, neighborhood, listing_type, source, scraped_date, processed_date, created_at)\n            VALUES (:property_id, :price, :bedrooms, :area, :bathrooms, :property_type, :property_type_standard, :price_per_sqm, :price_per_bedroom, :city, :neighborhood, :listing_type, :source, :scraped_date, :processed_date, :created_at)\n            ON CONFLICT (property_id) DO UPDATE SET\n                property_id = EXCLUDED.property_id, price = EXCLUDED.price, bedrooms = EXCLUDED.bedrooms, area = EXCLUDED.area, bathrooms = EXCLUDED.bathrooms, property_type = EXCLUDED.property_type, property_type_standard = EXCLUDED.property_type_standard, price_per_sqm = EXCLUDED.price_per_sqm, price_per_bedroom = EXCLUDED.price_per_bedroom, city = EXCLUDED.city, neighborhood = EXCLUDED.neighborhood, listing_type = EXCLUDED.listing_type, source = EXCLUDED.source, scraped_date = EXCLUDED.scraped_date, processed_date = EXCLUDED.processed_date\n            ","logger":"loader"}
{"timestamp":"2025-07-21T18:09:31.757083","level":"error","event":"Error loading properties data from DataFrame: (psycopg2.errors.UndefinedColumn) column \"scraped_date\" of relation \"properties\" does not exist\nLINE 2: ...edroom, city, neighborhood, listing_type, source, scraped_da...\n                                                             ^\n\n[SQL: \n            INSERT INTO properties (property_id, price, bedrooms, area, bathrooms, property_type, property_type_standard, price_per_sqm, price_per_bedroom, city, neighborhood, listing_type, source, scraped_date, processed_date, created_at)\n            VALUES (%(property_id)s, %(price)s, %(bedrooms)s, %(area)s, %(bathrooms)s, %(property_type)s, %(property_type_standard)s, %(price_per_sqm)s, %(price_per_bedroom)s, %(city)s, %(neighborhood)s, %(listing_type)s, %(source)s, %(scraped_date)s, %(processed_date)s, %(created_at)s)\n            ON CONFLICT (property_id) DO UPDATE SET\n                property_id = EXCLUDED.property_id, price = EXCLUDED.price, bedrooms = EXCLUDED.bedrooms, area = EXCLUDED.area, bathrooms = EXCLUDED.bathrooms, property_type = EXCLUDED.property_type, property_type_standard = EXCLUDED.property_type_standard, price_per_sqm = EXCLUDED.price_per_sqm, price_per_bedroom = EXCLUDED.price_per_bedroom, city = EXCLUDED.city, neighborhood = EXCLUDED.neighborhood, listing_type = EXCLUDED.listing_type, source = EXCLUDED.source, scraped_date = EXCLUDED.scraped_date, processed_date = EXCLUDED.processed_date\n            ]\n[parameters: ({'property_id': '117248', 'price': 1320000.0, 'bedrooms': None, 'area': 400, 'bathrooms': None, 'property_type': 'أرض', 'property_type_standard': 'land', 'price_per_sqm': 3300.0, 'price_per_bedroom': None, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '72027', 'price': 1800000.0, 'bedrooms': None, 'area': 900, 'bathrooms': None, 'property_type': 'أرض', 'property_type_standard': 'land', 'price_per_sqm': 2000.0, 'price_per_bedroom': None, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '126752', 'price': 24000.0, 'bedrooms': 2, 'area': None, 'bathrooms': 1, 'property_type': 'شقة', 'property_type_standard': 'apartment', 'price_per_sqm': None, 'price_per_bedroom': 12000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '80556', 'price': 45000.0, 'bedrooms': 5, 'area': 420, 'bathrooms': 4, 'property_type': 'دور', 'property_type_standard': 'floor', 'price_per_sqm': 107.14285714285714, 'price_per_bedroom': 9000.0, 'city': 'Riyadh', 'neighborhood': 'Al Yasmeen', 'listing_type': 'rent', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '72580', 'price': 600000.0, 'bedrooms': 4, 'area': 164, 'bathrooms': 4, 'property_type': 'شقة', 'property_type_standard': 'apartment', 'price_per_sqm': 3658.5365853658536, 'price_per_bedroom': 150000.0, 'city': 'Riyadh', 'neighborhood': 'Al Yasmeen', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '39973', 'price': 7500000.0, 'bedrooms': 5, 'area': 1036, 'bathrooms': 5, 'property_type': 'فيلا', 'property_type_standard': 'villa', 'price_per_sqm': 7239.382239382239, 'price_per_bedroom': 1000000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '123653', 'price': 1218000.0, 'bedrooms': None, 'area': 406, 'bathrooms': None, 'property_type': 'أرض', 'property_type_standard': 'land', 'price_per_sqm': 3000.0, 'price_per_bedroom': None, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '84993', 'price': 21000.0, 'bedrooms': 2, 'area': None, 'bathrooms': 2, 'property_type': 'شقة', 'property_type_standard': 'apartment', 'price_per_sqm': None, 'price_per_bedroom': 10500.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}  ... displaying 10 of 10021 total bound parameter sets ...  {'property_id': '29964', 'price': 60000.0, 'bedrooms': 4, 'area': 450, 'bathrooms': 3, 'property_type': 'دور', 'property_type_standard': 'floor', 'price_per_sqm': 133.33333333333334, 'price_per_bedroom': 15000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '34620', 'price': 1260000.0, 'bedrooms': None, 'area': 450, 'bathrooms': None, 'property_type': 'أرض', 'property_type_standard': 'land', 'price_per_sqm': 2800.0, 'price_per_bedroom': None, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None})]\n(Background on this error at: https://sqlalche.me/e/14/f405)","logger":"loader"}
{"timestamp":"2025-07-21T18:09:31.757759","level":"error","event":"Error details: (psycopg2.errors.UndefinedColumn) column \"scraped_date\" of relation \"properties\" does not exist\nLINE 2: ...edroom, city, neighborhood, listing_type, source, scraped_da...\n                                                             ^\n\n[SQL: \n            INSERT INTO properties (property_id, price, bedrooms, area, bathrooms, property_type, property_type_standard, price_per_sqm, price_per_bedroom, city, neighborhood, listing_type, source, scraped_date, processed_date, created_at)\n            VALUES (%(property_id)s, %(price)s, %(bedrooms)s, %(area)s, %(bathrooms)s, %(property_type)s, %(property_type_standard)s, %(price_per_sqm)s, %(price_per_bedroom)s, %(city)s, %(neighborhood)s, %(listing_type)s, %(source)s, %(scraped_date)s, %(processed_date)s, %(created_at)s)\n            ON CONFLICT (property_id) DO UPDATE SET\n                property_id = EXCLUDED.property_id, price = EXCLUDED.price, bedrooms = EXCLUDED.bedrooms, area = EXCLUDED.area, bathrooms = EXCLUDED.bathrooms, property_type = EXCLUDED.property_type, property_type_standard = EXCLUDED.property_type_standard, price_per_sqm = EXCLUDED.price_per_sqm, price_per_bedroom = EXCLUDED.price_per_bedroom, city = EXCLUDED.city, neighborhood = EXCLUDED.neighborhood, listing_type = EXCLUDED.listing_type, source = EXCLUDED.source, scraped_date = EXCLUDED.scraped_date, processed_date = EXCLUDED.processed_date\n            ]\n[parameters: ({'property_id': '117248', 'price': 1320000.0, 'bedrooms': None, 'area': 400, 'bathrooms': None, 'property_type': 'أرض', 'property_type_standard': 'land', 'price_per_sqm': 3300.0, 'price_per_bedroom': None, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '72027', 'price': 1800000.0, 'bedrooms': None, 'area': 900, 'bathrooms': None, 'property_type': 'أرض', 'property_type_standard': 'land', 'price_per_sqm': 2000.0, 'price_per_bedroom': None, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '126752', 'price': 24000.0, 'bedrooms': 2, 'area': None, 'bathrooms': 1, 'property_type': 'شقة', 'property_type_standard': 'apartment', 'price_per_sqm': None, 'price_per_bedroom': 12000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '80556', 'price': 45000.0, 'bedrooms': 5, 'area': 420, 'bathrooms': 4, 'property_type': 'دور', 'property_type_standard': 'floor', 'price_per_sqm': 107.14285714285714, 'price_per_bedroom': 9000.0, 'city': 'Riyadh', 'neighborhood': 'Al Yasmeen', 'listing_type': 'rent', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '72580', 'price': 600000.0, 'bedrooms': 4, 'area': 164, 'bathrooms': 4, 'property_type': 'شقة', 'property_type_standard': 'apartment', 'price_per_sqm': 3658.5365853658536, 'price_per_bedroom': 150000.0, 'city': 'Riyadh', 'neighborhood': 'Al Yasmeen', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '39973', 'price': 7500000.0, 'bedrooms': 5, 'area': 1036, 'bathrooms': 5, 'property_type': 'فيلا', 'property_type_standard': 'villa', 'price_per_sqm': 7239.382239382239, 'price_per_bedroom': 1000000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '123653', 'price': 1218000.0, 'bedrooms': None, 'area': 406, 'bathrooms': None, 'property_type': 'أرض', 'property_type_standard': 'land', 'price_per_sqm': 3000.0, 'price_per_bedroom': None, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '84993', 'price': 21000.0, 'bedrooms': 2, 'area': None, 'bathrooms': 2, 'property_type': 'شقة', 'property_type_standard': 'apartment', 'price_per_sqm': None, 'price_per_bedroom': 10500.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}  ... displaying 10 of 10021 total bound parameter sets ...  {'property_id': '29964', 'price': 60000.0, 'bedrooms': 4, 'area': 450, 'bathrooms': 3, 'property_type': 'دور', 'property_type_standard': 'floor', 'price_per_sqm': 133.33333333333334, 'price_per_bedroom': 15000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None}, {'property_id': '34620', 'price': 1260000.0, 'bedrooms': None, 'area': 450, 'bathrooms': None, 'property_type': 'أرض', 'property_type_standard': 'land', 'price_per_sqm': 2800.0, 'price_per_bedroom': None, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'historical', 'scraped_date': '2025-07-21 18:09:26', 'processed_date': Timestamp('2025-07-21 18:09:26'), 'created_at': None})]\n(Background on this error at: https://sqlalche.me/e/14/f405)","logger":"loader"}
{"timestamp":"2025-07-21T18:09:31.758486","level":"info","event":"Database connection closed","logger":"loader"}
{"timestamp":"2025-07-21T18:09:31.758841","level":"error","event":"Task failed with exception","logger":"task","error_detail":[{"exc_type":"Exception","exc_value":"Failed to load historical data into database","exc_notes":[],"syntax_error":null,"is_cause":false,"frames":[{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/execution_time/task_runner.py","lineno":825,"name":"run"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/execution_time/task_runner.py","lineno":1088,"name":"_execute_task"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/bases/operator.py","lineno":408,"name":"wrapper"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/providers/standard/operators/python.py","lineno":212,"name":"execute"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/providers/standard/operators/python.py","lineno":235,"name":"execute_callable"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/execution_time/callback_runner.py","lineno":81,"name":"run"},{"filename":"/opt/airflow/dags/load_historical_data.py","lineno":35,"name":"load_historical_data_task"}]}]}
