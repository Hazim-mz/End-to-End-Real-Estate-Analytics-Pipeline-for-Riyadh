{"timestamp":"2025-07-21T02:01:50.334343","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-07-21T02:01:50.335071","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/etl_pipeline_v2.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-07-21T02:01:51.071326","level":"warning","event":"Passing literal json to 'read_json' is deprecated and will be removed in a future version. To read from a literal string, wrap it in a 'StringIO' object.","category":"FutureWarning","filename":"/opt/airflow/dags/etl_pipeline_v2.py","lineno":57,"logger":"py.warnings"}
{"timestamp":"2025-07-21T02:01:51.089468","level":"info","event":"Successfully connected to PostgreSQL database","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.091872","level":"info","event":"Tables already exist, skipping creation","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.095685","level":"info","event":"Found unique constraint(s): ['properties_property_id_key']","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.097305","level":"info","event":"Loading 8 properties to database using batch UPSERT","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.097816","level":"info","event":"Property IDs in data: 8 unique IDs","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.099177","level":"info","event":"Found 0 existing property_ids in database","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.099699","level":"info","event":"All property_ids are new - will be inserted","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.111082","level":"info","event":"Executing batch UPSERT with 8 records","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.111244","level":"info","event":"UPSERT Query: \n            INSERT INTO properties (property_id, title, price, bedrooms, area, bathrooms, property_type, property_type_standard, price_per_sqm, price_per_bedroom, city, neighborhood, listing_type, source, processed_date, created_at)\n            VALUES (:property_id, :title, :price, :bedrooms, :area, :bathrooms, :property_type, :property_type_standard, :price_per_sqm, :price_per_bedroom, :city, :neighborhood, :listing_type, :source, :processed_date, :created_at)\n            ON CONFLICT (property_id) DO UPDATE SET\n                property_id = EXCLUDED.property_id, title = EXCLUDED.title, price = EXCLUDED.price, bedrooms = EXCLUDED.bedrooms, area = EXCLUDED.area, bathrooms = EXCLUDED.bathrooms, property_type = EXCLUDED.property_type, property_type_standard = EXCLUDED.property_type_standard, price_per_sqm = EXCLUDED.price_per_sqm, price_per_bedroom = EXCLUDED.price_per_bedroom, city = EXCLUDED.city, neighborhood = EXCLUDED.neighborhood, listing_type = EXCLUDED.listing_type, source = EXCLUDED.source, processed_date = EXCLUDED.processed_date\n            ","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.114770","level":"error","event":"Error loading properties data from DataFrame: (psycopg2.errors.UndefinedColumn) column \"created_at\" of relation \"properties\" does not exist\nLINE 2: ...ighborhood, listing_type, source, processed_date, created_at...\n                                                             ^\n\n[SQL: \n            INSERT INTO properties (property_id, title, price, bedrooms, area, bathrooms, property_type, property_type_standard, price_per_sqm, price_per_bedroom, city, neighborhood, listing_type, source, processed_date, created_at)\n            VALUES (%(property_id)s, %(title)s, %(price)s, %(bedrooms)s, %(area)s, %(bathrooms)s, %(property_type)s, %(property_type_standard)s, %(price_per_sqm)s, %(price_per_bedroom)s, %(city)s, %(neighborhood)s, %(listing_type)s, %(source)s, %(processed_date)s, %(created_at)s)\n            ON CONFLICT (property_id) DO UPDATE SET\n                property_id = EXCLUDED.property_id, title = EXCLUDED.title, price = EXCLUDED.price, bedrooms = EXCLUDED.bedrooms, area = EXCLUDED.area, bathrooms = EXCLUDED.bathrooms, property_type = EXCLUDED.property_type, property_type_standard = EXCLUDED.property_type_standard, price_per_sqm = EXCLUDED.price_per_sqm, price_per_bedroom = EXCLUDED.price_per_bedroom, city = EXCLUDED.city, neighborhood = EXCLUDED.neighborhood, listing_type = EXCLUDED.listing_type, source = EXCLUDED.source, processed_date = EXCLUDED.processed_date\n            ]\n[parameters: ({'property_id': '1b87659b-dc5c-4d2a-b312-c79a20de9abe', 'title': 'شقة للإيجار', 'price': 60000, 'bedrooms': 2.0, 'area': 12695, 'bathrooms': None, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 4.7262701851, 'price_per_bedroom': 30000.0, 'city': 'Riyadh', 'neighborhood': 'Al Yasmeen', 'listing_type': 'rent', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': '857ef9f8-af46-4d9f-ba3e-e3839243fb71', 'title': 'غرفة للإيجار', 'price': 15000, 'bedrooms': None, 'area': 8, 'bathrooms': None, 'property_type': 'room', 'property_type_standard': 'room', 'price_per_sqm': 1875.0, 'price_per_bedroom': None, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': '52b52a55-f98a-4d98-865a-98721c63082c', 'title': 'شقة للبيع', 'price': 1350000, 'bedrooms': 3.0, 'area': 138, 'bathrooms': 3.0, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 9782.6086956522, 'price_per_bedroom': 450000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': 'c5cb1da6-50a1-4074-a14d-f65982d0b0e1', 'title': 'شقة للبيع', 'price': 1300000, 'bedrooms': 3.0, 'area': 131, 'bathrooms': 3.0, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 9923.6641221374, 'price_per_bedroom': 433333.3333333333, 'city': 'Riyadh', 'neighborhood': 'Al Yasmeen', 'listing_type': 'sale', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': '1bda0555-4030-4105-82e4-dc924fe3d11c', 'title': 'فيلا للإيجار', 'price': 80388, 'bedrooms': 3.0, 'area': 95, 'bathrooms': None, 'property_type': 'villa', 'property_type_standard': 'villa', 'price_per_sqm': 846.1894736842, 'price_per_bedroom': 26796.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': '9a19e153-cb45-43dc-a1e7-10f82a3097e3', 'title': 'شقة للإيجار', 'price': 85000, 'bedrooms': 3.0, 'area': 139, 'bathrooms': 3.0, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 611.5107913669, 'price_per_bedroom': 28333.3333333333, 'city': 'Riyadh', 'neighborhood': 'Al Yasmeen', 'listing_type': 'rent', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': 'f67f43f9-17fd-4dda-8075-f1f2d585e3d0', 'title': 'مجمع للإيجار', 'price': 1615500, 'bedrooms': 1.0, 'area': 718, 'bathrooms': None, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 2250.0, 'price_per_bedroom': 1000000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': 'f7514515-0800-469e-997c-80b51c60127a', 'title': 'شقة للبيع', 'price': 1150000, 'bedrooms': 2.0, 'area': 145, 'bathrooms': 3.0, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 7931.0344827586, 'price_per_bedroom': 575000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')})]\n(Background on this error at: https://sqlalche.me/e/14/f405)","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.115182","level":"error","event":"Error details: (psycopg2.errors.UndefinedColumn) column \"created_at\" of relation \"properties\" does not exist\nLINE 2: ...ighborhood, listing_type, source, processed_date, created_at...\n                                                             ^\n\n[SQL: \n            INSERT INTO properties (property_id, title, price, bedrooms, area, bathrooms, property_type, property_type_standard, price_per_sqm, price_per_bedroom, city, neighborhood, listing_type, source, processed_date, created_at)\n            VALUES (%(property_id)s, %(title)s, %(price)s, %(bedrooms)s, %(area)s, %(bathrooms)s, %(property_type)s, %(property_type_standard)s, %(price_per_sqm)s, %(price_per_bedroom)s, %(city)s, %(neighborhood)s, %(listing_type)s, %(source)s, %(processed_date)s, %(created_at)s)\n            ON CONFLICT (property_id) DO UPDATE SET\n                property_id = EXCLUDED.property_id, title = EXCLUDED.title, price = EXCLUDED.price, bedrooms = EXCLUDED.bedrooms, area = EXCLUDED.area, bathrooms = EXCLUDED.bathrooms, property_type = EXCLUDED.property_type, property_type_standard = EXCLUDED.property_type_standard, price_per_sqm = EXCLUDED.price_per_sqm, price_per_bedroom = EXCLUDED.price_per_bedroom, city = EXCLUDED.city, neighborhood = EXCLUDED.neighborhood, listing_type = EXCLUDED.listing_type, source = EXCLUDED.source, processed_date = EXCLUDED.processed_date\n            ]\n[parameters: ({'property_id': '1b87659b-dc5c-4d2a-b312-c79a20de9abe', 'title': 'شقة للإيجار', 'price': 60000, 'bedrooms': 2.0, 'area': 12695, 'bathrooms': None, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 4.7262701851, 'price_per_bedroom': 30000.0, 'city': 'Riyadh', 'neighborhood': 'Al Yasmeen', 'listing_type': 'rent', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': '857ef9f8-af46-4d9f-ba3e-e3839243fb71', 'title': 'غرفة للإيجار', 'price': 15000, 'bedrooms': None, 'area': 8, 'bathrooms': None, 'property_type': 'room', 'property_type_standard': 'room', 'price_per_sqm': 1875.0, 'price_per_bedroom': None, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': '52b52a55-f98a-4d98-865a-98721c63082c', 'title': 'شقة للبيع', 'price': 1350000, 'bedrooms': 3.0, 'area': 138, 'bathrooms': 3.0, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 9782.6086956522, 'price_per_bedroom': 450000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': 'c5cb1da6-50a1-4074-a14d-f65982d0b0e1', 'title': 'شقة للبيع', 'price': 1300000, 'bedrooms': 3.0, 'area': 131, 'bathrooms': 3.0, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 9923.6641221374, 'price_per_bedroom': 433333.3333333333, 'city': 'Riyadh', 'neighborhood': 'Al Yasmeen', 'listing_type': 'sale', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': '1bda0555-4030-4105-82e4-dc924fe3d11c', 'title': 'فيلا للإيجار', 'price': 80388, 'bedrooms': 3.0, 'area': 95, 'bathrooms': None, 'property_type': 'villa', 'property_type_standard': 'villa', 'price_per_sqm': 846.1894736842, 'price_per_bedroom': 26796.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': '9a19e153-cb45-43dc-a1e7-10f82a3097e3', 'title': 'شقة للإيجار', 'price': 85000, 'bedrooms': 3.0, 'area': 139, 'bathrooms': 3.0, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 611.5107913669, 'price_per_bedroom': 28333.3333333333, 'city': 'Riyadh', 'neighborhood': 'Al Yasmeen', 'listing_type': 'rent', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': 'f67f43f9-17fd-4dda-8075-f1f2d585e3d0', 'title': 'مجمع للإيجار', 'price': 1615500, 'bedrooms': 1.0, 'area': 718, 'bathrooms': None, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 2250.0, 'price_per_bedroom': 1000000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'rent', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')}, {'property_id': 'f7514515-0800-469e-997c-80b51c60127a', 'title': 'شقة للبيع', 'price': 1150000, 'bedrooms': 2.0, 'area': 145, 'bathrooms': 3.0, 'property_type': 'apartment', 'property_type_standard': 'apartment', 'price_per_sqm': 7931.0344827586, 'price_per_bedroom': 575000.0, 'city': 'Riyadh', 'neighborhood': 'Al Malga', 'listing_type': 'sale', 'source': 'scraped', 'processed_date': Timestamp('2025-07-21 02:01:47'), 'created_at': Timestamp('2025-07-21 05:01:51.103919+0300', tz='Asia/Riyadh')})]\n(Background on this error at: https://sqlalche.me/e/14/f405)","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.115660","level":"info","event":"Database connection closed","logger":"loader"}
{"timestamp":"2025-07-21T02:01:51.115766","level":"error","event":"Task failed with exception","logger":"task","error_detail":[{"exc_type":"Exception","exc_value":"Failed to load properties into database","exc_notes":[],"syntax_error":null,"is_cause":false,"frames":[{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/execution_time/task_runner.py","lineno":825,"name":"run"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/execution_time/task_runner.py","lineno":1088,"name":"_execute_task"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/bases/operator.py","lineno":408,"name":"wrapper"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/providers/standard/operators/python.py","lineno":212,"name":"execute"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/providers/standard/operators/python.py","lineno":235,"name":"execute_callable"},{"filename":"/home/airflow/.local/lib/python3.12/site-packages/airflow/sdk/execution_time/callback_runner.py","lineno":81,"name":"run"},{"filename":"/opt/airflow/dags/etl_pipeline_v2.py","lineno":72,"name":"load_data"}]}]}
